йт
GC:\vsproj\beck\bia.internal.booklibrary\WebApiBookLibrary\GetBadBook.cs
	namespace 	
WebApiBookLibrary
 
{		 
public

 

enum

 
	TypeQuery

 
{ 
AllBook 
= 
$num 
, 
BookByLogin 
= 
$num 
, 
} 
public 

class 
	AdminInfo 
{ 
public 
int 
CountReturnToDay #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int 
RequestToDay 
{  !
get" %
;% &
set' *
;* +
}, -
public 
	AdminInfo 
( 
) 
{ 	
this 
. 
CountReturnToDay !
=" #
$num$ %
;% &
this 
. 
RequestToDay 
= 
$num  !
;! "
} 	
public 
	AdminInfo 
( 
int 
countReturnToDay -
,- .
int/ 2
requestToDay3 ?
)? @
{ 	
this 
. 
CountReturnToDay !
=" #
countReturnToDay$ 4
;4 5
this 
. 
RequestToDay 
= 
requestToDay  ,
;, -
} 	
public   
	AdminInfo   
?   
Load   
(   
string   %
strConn  & -
,  - .
string  / 5
login  6 ;
)  ; <
{!! 	
	AdminInfo"" 
?"" 
result"" 
="" 
new""  #
	AdminInfo""$ -
(""- .
)"". /
;""/ 0
int## 
countReturnToDay##  
=##! "
$num### $
;##$ %
int$$ 
countRequestToDay$$ !
=$$" #
$num$$$ %
;$$% &
string%% 
role%% 
=%% 
string%%  
.%%  !
Empty%%! &
;%%& '
if'' 
('' 
string'' 
.'' 
IsNullOrWhiteSpace'' )
('') *
login''* /
)''/ 0
)''0 1
throw(( 
new(( 
	Exception(( #
(((# $
$str(($ V
)((V W
;((W X
if)) 
()) 
string)) 
.)) 
IsNullOrWhiteSpace)) )
())) *
strConn))* 1
)))1 2
)))2 3
throw** 
new** 
	Exception** #
(**# $
$str**$ X
)**X Y
;**Y Z
using,, 
(,, 
MySqlConnection,, "
conn,,# '
=,,( )
new,,* -
MySqlConnection,,. =
(,,= >
strConn,,> E
),,E F
),,F G
{-- 
conn.. 
... 
Open.. 
(.. 
).. 
;.. 
if// 
(// 
conn// 
.// 
State// 
==// !
ConnectionState//" 1
.//1 2
Open//2 6
)//6 7
{00 
using22 
(22 
MySqlCommand22 '
cmd22( +
=22, -
new22. 1
MySqlCommand222 >
(22> ?
WebApiAdoNet22? K
.22K L
GetRoleByUserLogin22L ^
(22^ _
)22_ `
,22` a
conn22b f
)22f g
)22g h
{33 
cmd44 
.44 

Parameters44 &
.44& '
Add44' *
(44* +
new44+ .
MySqlParameter44/ =
(44= >
$str44> F
,44F G
login44H M
)44M N
)44N O
;44O P
using66 
(66 
MySqlDataReader66 .
reader66/ 5
=666 7
cmd668 ;
.66; <
ExecuteReader66< I
(66I J
)66J K
)66K L
{77 
if88 
(88  
reader88  &
.88& '
Read88' +
(88+ ,
)88, -
)88- .
{99 
if::  "
(::# $
reader::$ *
.::* +
GetValue::+ 3
(::3 4
$num::4 5
)::5 6
==::7 9
null::: >
)::> ?
throw;;$ )
new;;* -
	Exception;;. 7
(;;7 8
$str;;8 r
);;r s
;;;s t
role==  $
===% &
reader==' -
.==- .
	GetString==. 7
(==7 8
$num==8 9
)==9 :
;==: ;
}>> 
}?? 
}@@ 
ifBB 
(BB 
roleBB 
==BB 
$strBB  '
)BB' (
{CC 
usingDD 
(DD 
MySqlCommandDD +
	cmdReturnDD, 5
=DD6 7
newDD8 ;
MySqlCommandDD< H
(DDH I
WebApiAdoNetDDI U
.DDU V
GetCountReturnToDayDDV i
(DDi j
)DDj k
,DDk l
connDDm q
)DDq r
)DDr s
{EE 
usingFF !
(FF" #
MySqlDataReaderFF# 2
readerFF3 9
=FF: ;
	cmdReturnFF< E
.FFE F
ExecuteReaderFFF S
(FFS T
)FFT U
)FFU V
{GG 
ifHH  "
(HH# $
readerHH$ *
.HH* +
ReadHH+ /
(HH/ 0
)HH0 1
)HH1 2
{II  !
ifJJ$ &
(JJ' (
readerJJ( .
.JJ. /
GetValueJJ/ 7
(JJ7 8
$numJJ8 9
)JJ9 :
==JJ; =
nullJJ> B
)JJB C
throwKK( -
newKK. 1
	ExceptionKK2 ;
(KK; <
$strKK< y
)KKy z
;KKz {
countReturnToDayMM$ 4
=MM5 6
readerMM7 =
.MM= >
GetInt32MM> F
(MMF G
$numMMG H
)MMH I
;MMI J
}NN  !
}OO 
}PP 
usingRR 
(RR 
MySqlCommandRR +

cmdRequestRR, 6
=RR7 8
newRR9 <
MySqlCommandRR= I
(RRI J
WebApiAdoNetRRJ V
.RRV W
GetCountRequestRRW f
(RRf g
)RRg h
,RRh i
connRRj n
)RRn o
)RRo p
{SS 
usingTT !
(TT" #
MySqlDataReaderTT# 2
readerTT3 9
=TT: ;

cmdRequestTT< F
.TTF G
ExecuteReaderTTG T
(TTT U
)TTU V
)TTV W
{UU 
ifVV  "
(VV# $
readerVV$ *
.VV* +
ReadVV+ /
(VV/ 0
)VV0 1
)VV1 2
{WW  !
ifXX$ &
(XX' (
readerXX( .
.XX. /
GetValueXX/ 7
(XX7 8
$numXX8 9
)XX9 :
==XX; =
nullXX> B
)XXB C
throwYY( -
newYY. 1
	ExceptionYY2 ;
(YY; <
$strYY< z
)YYz {
;YY{ |
countRequestToDay[[$ 5
=[[6 7
reader[[8 >
.[[> ?
GetInt32[[? G
([[G H
$num[[H I
)[[I J
;[[J K
}\\  !
}]] 
}^^ 
result`` 
=``  
new``! $
	AdminInfo``% .
(``. /
countReturnToDay``/ ?
,``? @
countRequestToDay``A R
)``R S
;``S T
}aa 
elsebb 
{cc 
resultdd 
=dd  
nulldd! %
;dd% &
}ee 
}ff 
}gg 
returnii 
resultii 
;ii 
}jj 	
}kk 
publicmm 

classmm 
Autorsmm 
{nn 
publicoo 
stringoo 
FirstNameAutorsoo %
{oo& '
getoo( +
;oo+ ,
setoo- 0
;oo0 1
}oo2 3
publicpp 
stringpp 
MiddleNameAutorspp &
{pp' (
getpp) ,
;pp, -
setpp. 1
;pp1 2
}pp3 4
publicqq 
stringqq 
LastNameAutorsqq $
{qq% &
getqq' *
;qq* +
setqq, /
;qq/ 0
}qq1 2
publicss 
Autorsss 
(ss 
)ss 
{tt 	
thisuu 
.uu 
FirstNameAutorsuu  
=uu! "
stringuu# )
.uu) *
Emptyuu* /
;uu/ 0
thisvv 
.vv 
MiddleNameAutorsvv !
=vv" #
stringvv$ *
.vv* +
Emptyvv+ 0
;vv0 1
thisww 
.ww 
LastNameAutorsww 
=ww  !
stringww" (
.ww( )
Emptyww) .
;ww. /
}xx 	
publiczz 
Autorszz 
(zz 
stringzz 
firstNameAutorszz ,
,zz, -
stringzz. 4
middleNameAutorszz5 E
,zzE F
stringzzG M
lastNameAutorszzN \
)zz\ ]
{{{ 	
this|| 
.|| 
FirstNameAutors||  
=||! "
firstNameAutors||# 2
;||2 3
this}} 
.}} 
MiddleNameAutors}} !
=}}" #
middleNameAutors}}$ 4
;}}4 5
this~~ 
.~~ 
LastNameAutors~~ 
=~~  !
lastNameAutors~~" 0
;~~0 1
} 	
}
АА 
public
ВВ 

class
ВВ 
UserDetails
ВВ 
{
ГГ 
public
ДД 
string
ДД 
Login
ДД 
{
ДД 
get
ДД !
;
ДД! "
set
ДД# &
;
ДД& '
}
ДД( )
public
ЕЕ 
string
ЕЕ 
FullName
ЕЕ 
{
ЕЕ  
get
ЕЕ! $
;
ЕЕ$ %
set
ЕЕ& )
;
ЕЕ) *
}
ЕЕ+ ,
public
ЖЖ 
string
ЖЖ 
Role
ЖЖ 
{
ЖЖ 
get
ЖЖ  
;
ЖЖ  !
set
ЖЖ" %
;
ЖЖ% &
}
ЖЖ' (
public
ИИ 
UserDetails
ИИ 
(
ИИ 
)
ИИ 
{
ЙЙ 	
this
КК 
.
КК 
Login
КК 
=
КК 
string
КК 
.
КК  
Empty
КК  %
;
КК% &
this
ЛЛ 
.
ЛЛ 
FullName
ЛЛ 
=
ЛЛ 
string
ЛЛ "
.
ЛЛ" #
Empty
ЛЛ# (
;
ЛЛ( )
this
ММ 
.
ММ 
Role
ММ 
=
ММ 
string
ММ 
.
ММ 
Empty
ММ $
;
ММ$ %
}
НН 	
public
ПП 
UserDetails
ПП 
(
ПП 
string
ПП !
login
ПП" '
,
ПП' (
string
ПП) /
fullName
ПП0 8
,
ПП8 9
string
ПП: @
role
ППA E
)
ППE F
{
РР 	
this
СС 
.
СС 
Login
СС 
=
СС 
login
СС 
;
СС 
this
ТТ 
.
ТТ 
FullName
ТТ 
=
ТТ 
fullName
ТТ $
;
ТТ$ %
this
УУ 
.
УУ 
Role
УУ 
=
УУ 
role
УУ 
;
УУ 
}
ФФ 	
}
ХХ 
public
ЧЧ 

class
ЧЧ $
GetBadBooksByUserLogin
ЧЧ '
{
ШШ 
public
ЩЩ 
int
ЩЩ 
BookId
ЩЩ 
{
ЩЩ 
get
ЩЩ 
;
ЩЩ  
set
ЩЩ! $
;
ЩЩ$ %
}
ЩЩ& '
public
ЪЪ 
string
ЪЪ 
Title
ЪЪ 
{
ЪЪ 
get
ЪЪ !
;
ЪЪ! "
set
ЪЪ# &
;
ЪЪ& '
}
ЪЪ( )
public
ЫЫ 
DateTime
ЫЫ 
	TakenDate
ЫЫ !
{
ЫЫ" #
get
ЫЫ$ '
;
ЫЫ' (
set
ЫЫ) ,
;
ЫЫ, -
}
ЫЫ. /
public
ЬЬ 
DateTime
ЬЬ 
ExtendedDueDate
ЬЬ '
{
ЬЬ( )
get
ЬЬ* -
;
ЬЬ- .
set
ЬЬ/ 2
;
ЬЬ2 3
}
ЬЬ4 5
public
ЭЭ 
List
ЭЭ 
<
ЭЭ 
Autors
ЭЭ 
>
ЭЭ 
AutorsForBook
ЭЭ )
{
ЭЭ* +
get
ЭЭ, /
;
ЭЭ/ 0
set
ЭЭ1 4
;
ЭЭ4 5
}
ЭЭ6 7
public
ЯЯ $
GetBadBooksByUserLogin
ЯЯ %
(
ЯЯ% &
)
ЯЯ& '
{
аа 	
this
бб 
.
бб 
BookId
бб 
=
бб 
$num
бб 
;
бб 
this
вв 
.
вв 
Title
вв 
=
вв 
string
вв 
.
вв  
Empty
вв  %
;
вв% &
this
гг 
.
гг 
	TakenDate
гг 
=
гг 
new
гг  
DateTime
гг! )
(
гг) *
)
гг* +
;
гг+ ,
this
дд 
.
дд 
ExtendedDueDate
дд  
=
дд! "
new
дд# &
DateTime
дд' /
(
дд/ 0
)
дд0 1
;
дд1 2
this
ее 
.
ее 
AutorsForBook
ее 
=
ее  
new
ее! $
List
ее% )
<
ее) *
Autors
ее* 0
>
ее0 1
(
ее1 2
)
ее2 3
;
ее3 4
}
жж 	
public
ии $
GetBadBooksByUserLogin
ии %
(
ии% &
int
ии& )
bookId
ии* 0
,
ии0 1
string
ии2 8
title
ии9 >
,
ии> ?
DateTime
ии@ H
	takenDate
ииI R
,
ииR S
DateTime
йй 
extendedDueDate
йй $
,
йй$ %
List
йй& *
<
йй* +
Autors
йй+ 1
>
йй1 2
autors
йй3 9
)
йй9 :
{
кк 	
this
лл 
.
лл 
BookId
лл 
=
лл 
bookId
лл  
;
лл  !
this
мм 
.
мм 
Title
мм 
=
мм 
title
мм 
;
мм 
this
нн 
.
нн 
	TakenDate
нн 
=
нн 
	takenDate
нн &
;
нн& '
this
оо 
.
оо 
ExtendedDueDate
оо  
=
оо! "
extendedDueDate
оо# 2
;
оо2 3
this
пп 
.
пп 
AutorsForBook
пп 
=
пп  
autors
пп! '
;
пп' (
}
░░ 	
}
▒▒ 
public
││ 

class
││ 
UserInfo
││ 
{
┤┤ 
public
╡╡ 
UserDetails
╡╡ 
UserDetails
╡╡ &
{
╡╡' (
get
╡╡) ,
;
╡╡, -
set
╡╡. 1
;
╡╡1 2
}
╡╡3 4
public
╢╢ 
List
╢╢ 
<
╢╢ $
GetBadBooksByUserLogin
╢╢ *
>
╢╢* +
BadBooksByUser
╢╢, :
{
╢╢; <
get
╢╢= @
;
╢╢@ A
set
╢╢B E
;
╢╢E F
}
╢╢G H
public
╕╕ 
UserInfo
╕╕ 
(
╕╕ 
)
╕╕ 
{
╣╣ 	
this
║║ 
.
║║ 
UserDetails
║║ 
=
║║ 
new
║║ "
UserDetails
║║# .
(
║║. /
)
║║/ 0
;
║║0 1
this
╗╗ 
.
╗╗ 
BadBooksByUser
╗╗ 
=
╗╗  !
new
╗╗" %
List
╗╗& *
<
╗╗* +$
GetBadBooksByUserLogin
╗╗+ A
>
╗╗A B
(
╗╗B C
)
╗╗C D
;
╗╗D E
}
╝╝ 	
public
╛╛ 
UserInfo
╛╛ 
(
╛╛ 
UserDetails
╛╛ #
userDetails
╛╛$ /
,
╛╛/ 0
List
╛╛1 5
<
╛╛5 6$
GetBadBooksByUserLogin
╛╛6 L
>
╛╛L M
badBooksByUsers
╛╛N ]
)
╛╛] ^
{
┐┐ 	
this
└└ 
.
└└ 
UserDetails
└└ 
=
└└ 
userDetails
└└ *
;
└└* +
this
┴┴ 
.
┴┴ 
BadBooksByUser
┴┴ 
=
┴┴  !
badBooksByUsers
┴┴" 1
;
┴┴1 2
}
┬┬ 	
public
── 
UserInfo
── 
GetUserInfo
── #
(
──# $
string
──$ *
strConn
──+ 2
,
──2 3
string
──4 :
login
──; @
)
──@ A
{
┼┼ 	
UserInfo
╞╞ 
result
╞╞ 
=
╞╞ 
new
╞╞ !
UserInfo
╞╞" *
(
╞╞* +
)
╞╞+ ,
;
╞╞, -
UserDetails
╟╟ 
userDetails
╟╟ #
=
╟╟$ %
new
╟╟& )
UserDetails
╟╟* 5
(
╟╟5 6
)
╟╟6 7
;
╟╟7 8
List
╚╚ 
<
╚╚ $
GetBadBooksByUserLogin
╚╚ '
>
╚╚' ($
badBookSexUserByLogins
╚╚) ?
=
╚╚A B
new
╚╚C F
List
╚╚G K
<
╚╚K L$
GetBadBooksByUserLogin
╚╚L b
>
╚╚b c
(
╚╚c d
)
╚╚d e
;
╚╚e f
if
╩╩ 
(
╩╩ 
string
╩╩ 
.
╩╩  
IsNullOrWhiteSpace
╩╩ )
(
╩╩) *
login
╩╩* /
)
╩╩/ 0
)
╩╩0 1
throw
╦╦ 
new
╦╦ 
	Exception
╦╦ #
(
╦╦# $
$str
╦╦$ \
)
╦╦\ ]
;
╦╦] ^
if
╠╠ 
(
╠╠ 
string
╠╠ 
.
╠╠  
IsNullOrWhiteSpace
╠╠ )
(
╠╠) *
strConn
╠╠* 1
)
╠╠1 2
)
╠╠2 3
throw
══ 
new
══ 
	Exception
══ #
(
══# $
$str
══$ ^
)
══^ _
;
══_ `
using
╧╧ 
(
╧╧ 
MySqlConnection
╧╧ "
conn
╧╧# '
=
╧╧( )
new
╧╧* -
MySqlConnection
╧╧. =
(
╧╧= >
strConn
╧╧> E
)
╧╧E F
)
╧╧F G
{
╨╨ 
conn
╤╤ 
.
╤╤ 
Open
╤╤ 
(
╤╤ 
)
╤╤ 
;
╤╤ 
if
╥╥ 
(
╥╥ 
conn
╥╥ 
.
╥╥ 
State
╥╥ 
==
╥╥ !
ConnectionState
╥╥" 1
.
╥╥1 2
Open
╥╥2 6
)
╥╥6 7
{
╙╙ 
using
╘╘ 
(
╘╘ 
MySqlCommand
╘╘ '
cmd
╘╘( +
=
╘╘, -
new
╘╘. 1
MySqlCommand
╘╘2 >
(
╘╘> ?
WebApiAdoNet
╘╘? K
.
╘╘K L
GetUserInfo
╘╘L W
(
╘╘W X
)
╘╘X Y
,
╘╘Y Z
conn
╘╘[ _
)
╘╘_ `
)
╘╘` a
{
╒╒ 
cmd
╓╓ 
.
╓╓ 

Parameters
╓╓ &
.
╓╓& '
Add
╓╓' *
(
╓╓* +
new
╓╓+ .
MySqlParameter
╓╓/ =
(
╓╓= >
$str
╓╓> F
,
╓╓F G
login
╓╓H M
)
╓╓M N
)
╓╓N O
;
╓╓O P
using
╪╪ 
(
╪╪ 
MySqlDataReader
╪╪ .
reader
╪╪/ 5
=
╪╪6 7
cmd
╪╪8 ;
.
╪╪; <
ExecuteReader
╪╪< I
(
╪╪I J
)
╪╪J K
)
╪╪K L
{
┘┘ 
while
┌┌ !
(
┌┌" #
reader
┌┌# )
.
┌┌) *
Read
┌┌* .
(
┌┌. /
)
┌┌/ 0
)
┌┌0 1
{
██ 
if
▄▄  "
(
▄▄# $
reader
▄▄$ *
.
▄▄* +
GetValue
▄▄+ 3
(
▄▄3 4
$num
▄▄4 5
)
▄▄5 6
==
▄▄7 9
null
▄▄: >
)
▄▄> ?
throw
▌▌$ )
new
▌▌* -
	Exception
▌▌. 7
(
▌▌7 8
$str
▌▌8 p
)
▌▌p q
;
▌▌q r
if
▐▐  "
(
▐▐# $
reader
▐▐$ *
.
▐▐* +
GetValue
▐▐+ 3
(
▐▐3 4
$num
▐▐4 5
)
▐▐5 6
==
▐▐7 9
null
▐▐: >
)
▐▐> ?
throw
▀▀$ )
new
▀▀* -
	Exception
▀▀. 7
(
▀▀7 8
$str
▀▀8 s
)
▀▀s t
;
▀▀t u
if
рр  "
(
рр# $
reader
рр$ *
.
рр* +
GetValue
рр+ 3
(
рр3 4
$num
рр4 5
)
рр5 6
==
рр7 9
null
рр: >
)
рр> ?
throw
сс$ )
new
сс* -
	Exception
сс. 7
(
сс7 8
$str
сс8 o
)
ссo p
;
ссp q
userDetails
уу  +
=
уу, -
new
уу. 1
UserDetails
уу2 =
(
уу= >
reader
уу> D
.
ууD E
	GetString
ууE N
(
ууN O
$num
ууO P
)
ууP Q
,
ууQ R
reader
ууS Y
.
ууY Z
	GetString
ууZ c
(
ууc d
$num
ууd e
)
ууe f
,
ууf g
reader
ууh n
.
ууn o
	GetString
ууo x
(
ууx y
$num
ууy z
)
ууz {
)
уу{ |
;
уу| }
}
хх 
}
цц 
}
чч 
using
щщ 
(
щщ 
MySqlCommand
щщ '
cmd
щщ( +
=
щщ, -
new
щщ. 1
MySqlCommand
щщ2 >
(
щщ> ?
WebApiAdoNet
щщ? K
.
щщK L$
GetUsersByLoginBadBook
щщL b
(
щщb c
	TypeQuery
щщc l
.
щщl m
BookByLogin
щщm x
)
щщx y
,
щщy z
conn
щщ{ 
)щщ А
)щщА Б
{
ъъ 
cmd
ыы 
.
ыы 

Parameters
ыы &
.
ыы& '
Add
ыы' *
(
ыы* +
new
ыы+ .
MySqlParameter
ыы/ =
(
ыы= >
$str
ыы> F
,
ыыF G
login
ыыH M
)
ыыM N
)
ыыN O
;
ыыO P
using
ээ 
(
ээ 
MySqlDataReader
ээ .
reader
ээ/ 5
=
ээ6 7
cmd
ээ8 ;
.
ээ; <
ExecuteReader
ээ< I
(
ээI J
)
ээJ K
)
ээK L
{
юю 
while
яя !
(
яя" #
reader
яя# )
.
яя) *
Read
яя* .
(
яя. /
)
яя/ 0
)
яя0 1
{
ЁЁ 
if
ёё  "
(
ёё# $
reader
ёё$ *
.
ёё* +
GetValue
ёё+ 3
(
ёё3 4
$num
ёё4 5
)
ёё5 6
==
ёё7 9
null
ёё: >
)
ёё> ?
throw
ЄЄ$ )
new
ЄЄ* -
	Exception
ЄЄ. 7
(
ЄЄ7 8
$str
ЄЄ8 n
)
ЄЄn o
;
ЄЄo p
if
єє  "
(
єє# $
reader
єє$ *
.
єє* +
GetValue
єє+ 3
(
єє3 4
$num
єє4 5
)
єє5 6
==
єє7 9
null
єє: >
)
єє> ?
throw
ЇЇ$ )
new
ЇЇ* -
	Exception
ЇЇ. 7
(
ЇЇ7 8
$str
ЇЇ8 p
)
ЇЇp q
;
ЇЇq r
if
її  "
(
її# $
reader
її$ *
.
її* +
GetValue
її+ 3
(
її3 4
$num
її4 5
)
її5 6
==
її7 9
null
її: >
||
її? A
!
їїB C
(
їїC D
reader
їїD J
.
їїJ K
GetValue
їїK S
(
їїS T
$num
їїT U
)
їїU V
is
їїW Y
DateTime
їїZ b
)
їїb c
)
їїc d
throw
ЎЎ$ )
new
ЎЎ* -
	Exception
ЎЎ. 7
(
ЎЎ7 8
$str
ЎЎ8 v
)
ЎЎv w
;
ЎЎw x
if
ўў  "
(
ўў# $
reader
ўў$ *
.
ўў* +
GetValue
ўў+ 3
(
ўў3 4
$num
ўў4 5
)
ўў5 6
==
ўў7 9
null
ўў: >
||
ўў? A
!
ўўB C
(
ўўC D
reader
ўўD J
.
ўўJ K
GetValue
ўўK S
(
ўўS T
$num
ўўT U
)
ўўU V
is
ўўW Y
DateTime
ўўZ b
)
ўўb c
)
ўўc d
throw
°°$ )
new
°°* -
	Exception
°°. 7
(
°°7 8
$str
°°8 |
)
°°| }
;
°°} ~$
GetBadBooksByUserLogin
··  6&
getBadBookSexUserByLogin
··7 O
=
··P Q
new
··R U$
GetBadBooksByUserLogin
··V l
(
··l m
reader
··m s
.
··s t
GetInt32
··t |
(
··| }
$num
··} ~
)
··~ 
,·· А
reader··Б З
.··З И
	GetString··И С
(··С Т
$num··Т У
)··У Ф
,··Ф Х
reader
√√$ *
.
√√* +
GetDateTime
√√+ 6
(
√√6 7
$num
√√7 8
)
√√8 9
,
√√9 :
reader
√√; A
.
√√A B
GetDateTime
√√B M
(
√√M N
$num
√√N O
)
√√O P
,
√√P Q
null
√√R V
)
√√V W
;
√√W X$
badBookSexUserByLogins
¤¤  6
.
¤¤6 7
Add
¤¤7 :
(
¤¤: ;&
getBadBookSexUserByLogin
¤¤; S
)
¤¤S T
;
¤¤T U
}
■■ 
}
   
}
АА 
foreach
ВВ 
(
ВВ $
GetBadBooksByUserLogin
ВВ 3
item
ВВ4 8
in
ВВ9 ;$
badBookSexUserByLogins
ВВ< R
)
ВВR S
{
ГГ 
List
ДД 
<
ДД 
Autors
ДД #
>
ДД# $

autorsList
ДД% /
=
ДД0 1
new
ДД2 5
List
ДД6 :
<
ДД: ;
Autors
ДД; A
>
ДДA B
(
ДДB C
)
ДДC D
;
ДДD E
using
ЖЖ 
(
ЖЖ 
MySqlCommand
ЖЖ +
cmd
ЖЖ, /
=
ЖЖ0 1
new
ЖЖ2 5
MySqlCommand
ЖЖ6 B
(
ЖЖB C
WebApiAdoNet
ЖЖC O
.
ЖЖO P
GetAutorsById
ЖЖP ]
(
ЖЖ] ^
)
ЖЖ^ _
,
ЖЖ_ `
conn
ЖЖa e
)
ЖЖe f
)
ЖЖf g
{
ЗЗ 
cmd
ИИ 
.
ИИ  

Parameters
ИИ  *
.
ИИ* +
Add
ИИ+ .
(
ИИ. /
new
ИИ/ 2
MySqlParameter
ИИ3 A
(
ИИA B
$str
ИИB K
,
ИИK L
item
ИИM Q
.
ИИQ R
BookId
ИИR X
)
ИИX Y
)
ИИY Z
;
ИИZ [
using
КК !
(
КК" #
MySqlDataReader
КК# 2
reader
КК3 9
=
КК: ;
cmd
КК< ?
.
КК? @
ExecuteReader
КК@ M
(
ККM N
)
ККN O
)
ККO P
{
ЛЛ 
while
ММ  %
(
ММ& '
reader
ММ' -
.
ММ- .
Read
ММ. 2
(
ММ2 3
)
ММ3 4
)
ММ4 5
{
НН  !
if
ОО$ &
(
ОО' (
reader
ОО( .
.
ОО. /
GetValue
ОО/ 7
(
ОО7 8
$num
ОО8 9
)
ОО9 :
==
ОО; =
null
ОО> B
)
ООB C
throw
ПП( -
new
ПП. 1
	Exception
ПП2 ;
(
ПП; <
$str
ПП< ~
)
ПП~ 
;ПП А
if
РР$ &
(
РР' (
reader
РР( .
.
РР. /
GetValue
РР/ 7
(
РР7 8
$num
РР8 9
)
РР9 :
==
РР; =
null
РР> B
)
РРB C
throw
СС( -
new
СС. 1
	Exception
СС2 ;
(
СС; <
$str
СС< 
)СС А
;ССА Б
if
ТТ$ &
(
ТТ' (
reader
ТТ( .
.
ТТ. /
GetValue
ТТ/ 7
(
ТТ7 8
$num
ТТ8 9
)
ТТ9 :
==
ТТ; =
null
ТТ> B
)
ТТB C
throw
УУ( -
new
УУ. 1
	Exception
УУ2 ;
(
УУ; <
$str
УУ< }
)
УУ} ~
;
УУ~ 
Autors
ХХ$ *
autors
ХХ+ 1
=
ХХ2 3
new
ХХ4 7
Autors
ХХ8 >
(
ХХ> ?
reader
ХХ? E
.
ХХE F
	GetString
ХХF O
(
ХХO P
$num
ХХP Q
)
ХХQ R
,
ХХR S
reader
ХХT Z
.
ХХZ [
	GetString
ХХ[ d
(
ХХd e
$num
ХХe f
)
ХХf g
,
ХХg h
reader
ХХi o
.
ХХo p
	GetString
ХХp y
(
ХХy z
$num
ХХz {
)
ХХ{ |
)
ХХ| }
;
ХХ} ~

autorsList
ЧЧ$ .
.
ЧЧ. /
Add
ЧЧ/ 2
(
ЧЧ2 3
autors
ЧЧ3 9
)
ЧЧ9 :
;
ЧЧ: ;
}
ШШ  !
}
ЩЩ 
item
ЫЫ  
.
ЫЫ  !
AutorsForBook
ЫЫ! .
=
ЫЫ/ 0

autorsList
ЫЫ1 ;
;
ЫЫ; <
}
ЬЬ 
}
ЭЭ 
}
ЮЮ 
else
ЯЯ 
throw
аа 
new
аа 
	Exception
аа '
(
аа' (
string
аа( .
.
аа. /
Format
аа/ 5
(
аа5 6
$strаа6 В
,ааВ Г
conn
бб 
.
бб 
State
бб "
.
бб" #
ToString
бб# +
(
бб+ ,
)
бб, -
)
бб- .
)
бб. /
;
бб/ 0
}
вв 
result
дд 
=
дд 
new
дд 
UserInfo
дд !
(
дд! "
userDetails
дд" -
,
дд- .$
badBookSexUserByLogins
дд/ E
)
ддE F
;
ддF G
return
жж 
result
жж 
;
жж 
}
зз 	
}
ии 
}йй ╓0
DC:\vsproj\beck\bia.internal.booklibrary\WebApiBookLibrary\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
IConfiguration 
configuration 
= 
new " 
ConfigurationBuilder# 7
(7 8
)8 9
. 
AddJsonFile 
( 
$str *
,* +
optional, 4
:4 5
true6 :
,: ;
reloadOnChange< J
:J K
trueL P
)P Q
. 
Build 
( 
) 
; 
builder)) 
.)) 
Services)) 
.)) 
AddAuthentication)) "
())" #
NegotiateDefaults))# 4
.))4 5 
AuthenticationScheme))5 I
)))I J
.))J K
AddNegotiate))K W
())W X
)))X Y
;))Y Z

Dictionary55 

<55
 
string55 
,55 
string55 
>55 
	usersInfo55 $
=55% &
configuration55' 4
.554 5

GetSection555 ?
(55? @
$str55@ K
)55K L
.55L M
Get55M P
<55P Q

Dictionary55Q [
<55[ \
string55\ b
,55b c
string55d j
>55j k
>55k l
(55l m
)55m n
;55n o
string66 

domainName66 
=66 
configuration66 !
[66! "
$str66" .
]66. /
;66/ 0
builder77 
.77 
Services77 
.77 
AddAuthorization77 !
(77! "
options77" )
=>77* ,
{88 
options99 
.99 
	AddPolicy99 
(99 
$str99 *
,99* +
policy99, 2
=>993 5
{:: 
policy;; 
.;; 
RequireAssertion;; 
(;;  
context;;  '
=>;;( *
context<< 
.<< 
User<< 
!=<< 
null<< 
&&<<  "
context== 
.== 
User== 
.== 
Identity==  
!===! #
null==$ (
&&==) +
!>> 
string>> 
.>> 
IsNullOrEmpty>>  
(>>  !
context>>! (
.>>( )
User>>) -
.>>- .
Identity>>. 6
.>>6 7
Name>>7 ;
)>>; <
&&>>= ?
	usersInfo?? 
.?? 
Values?? 
.?? 
Contains?? $
(??$ %
context??% ,
.??, -
User??- 1
.??1 2
Identity??2 :
.??: ;
Name??; ?
.??? @
Replace??@ G
(??G H
$str??H R
,??R S
$str??T V
)??V W
)??W X
)??X Y
;??Y Z
}@@ 
)@@ 
;@@ 
}AA 
)AA 
;AA 
varGG 
appGG 
=GG 	
builderGG
 
.GG 
BuildGG 
(GG 
)GG 
;GG 
stringII 
connectionStringII 
=II 
configurationII '
.II' (
GetConnectionStringII( ;
(II; <
$strII< J
)IIJ K
;IIK L
appMM 
.MM 

UseSwaggerMM 
(MM 
)MM 
;MM 
appNN 
.NN 
UseSwaggerUINN 
(NN 
)NN 
;NN 
appRR 
.RR 
UseAuthenticationRR 
(RR 
)RR 
;RR 
appSS 
.SS 
UseAuthorizationSS 
(SS 
)SS 
;SS 
appUU 
.UU 
MapGetUU 

(UU
 
$strUU 
,UU 
(UU 
stringUU "
loginUU# (
)UU( )
=>UU* ,
{VV 
UserInfoWW 
userInfoWW 
=WW 
newWW 
UserInfoWW $
(WW$ %
)WW% &
;WW& '
returnXX 

userInfoXX 
.XX 
GetUserInfoXX 
(XX  
connectionStringXX  0
,XX0 1
loginXX2 7
)XX7 8
;XX8 9
}YY 
)YY 
.[[ 
WithName[[ 	
([[	 

$str[[
 
)[[ 
.\\  
RequireAuthorization\\ 
(\\ 
$str\\ *
)\\* +
;\\+ ,
appbb 
.bb 
MapGetbb 

(bb
 
$strbb 
,bb 
(bb 
HttpContextbb (
contextbb) 0
,bb0 1
stringbb2 8
loginbb9 >
)bb> ?
=>bb@ B
{cc 
	AdminInfodd 
?dd 
	adminInfodd 
=dd 
newdd 
	AdminInfodd (
(dd( )
)dd) *
;dd* +
	adminInfoee 
=ee 
	adminInfoee 
.ee 
Loadee 
(ee 
connectionStringee /
,ee/ 0
loginee1 6
)ee6 7
;ee7 8
ifff 
(ff 
	adminInfoff 
!=ff 
nullff 
)ff 
{gg 
returnhh 
	adminInfohh 
;hh 
}ii 
elsejj 
{kk 
contextll 
.ll 
Responsell 
.ll 

StatusCodell #
=ll$ %
$numll& )
;ll) *
returnnn 
nullnn 
;nn 
}oo 
}pp 
)pp 
.rr 
WithNamerr 	
(rr	 

$strrr
 
)rr 
.ss  
RequireAuthorizationss 
(ss 
$strss *
)ss* +
;ss+ ,
appxx 
.xx 
Runxx 
(xx 
)xx 	
;xx	 
╚+
IC:\vsproj\beck\bia.internal.booklibrary\WebApiBookLibrary\WebApiAdoNet.cs
	namespace 	
WebApiBookLibrary
 
{ 
public 

static 
class 
WebApiAdoNet $
{ 
public 
static 
string 
GetUserInfo (
(( )
)) *
{		 	
StringBuilder

 
sb

 
=

 
new

 "
StringBuilder

# 0
(

0 1
)

1 2
;

2 3
sb 
. 
Append 
( 
$str g
)g h
;h i
sb 
. 
Append 
( 
$str 6
)6 7
;7 8
return 
sb 
. 
ToString 
( 
)  
;  !
} 	
public 
static 
string "
GetUsersByLoginBadBook 3
(3 4
	TypeQuery4 =
	typeQuery> G
)G H
{ 	
StringBuilder 
sb 
= 
new "
StringBuilder# 0
(0 1
)1 2
;2 3
sb 
. 
Append 
( 
$str \
)\ ]
;] ^
sb 
. 
Append 
( 
$str 3
)3 4
;4 5
sb 
. 
Append 
( 
$str .
). /
;/ 0
sb 
. 
Append 
( 
$str 3
)3 4
;4 5
sb 
. 
Append 
( 
$str +
)+ ,
;, -
sb 
. 
Append 
( 
$str <
)< =
;= >
sb 
. 
Append 
( 
$str 
) 
;  
if 
( 
	typeQuery 
== 
	TypeQuery %
.% &
BookByLogin& 1
)1 2
sb 
. 
Append 
( 
$str 9
)9 :
;: ;
sb 
. 
Append 
( 
$str 3
)3 4
;4 5
return!! 
sb!! 
.!! 
ToString!! 
(!! 
)!!  
;!!  !
}"" 	
public$$ 
static$$ 
string$$ 
GetAutorsById$$ *
($$* +
)$$+ ,
{%% 	
StringBuilder&& 
sb&& 
=&& 
new&& "
StringBuilder&&# 0
(&&0 1
)&&1 2
;&&2 3
sb(( 
.(( 
Append(( 
((( 
$str(( N
)((N O
;((O P
sb)) 
.)) 
Append)) 
()) 
$str)) +
)))+ ,
;)), -
sb** 
.** 
Append** 
(** 
$str** 3
)**3 4
;**4 5
sb++ 
.++ 
Append++ 
(++ 
$str++ 6
)++6 7
;++7 8
sb,, 
.,, 
Append,, 
(,, 
$str,, -
),,- .
;,,. /
sb-- 
.-- 
Append-- 
(-- 
$str-- =
)--= >
;--> ?
sb.. 
... 
Append.. 
(.. 
$str.. 3
)..3 4
;..4 5
return00 
sb00 
.00 
ToString00 
(00 
)00  
;00  !
}11 	
public33 
static33 
string33 
GetRoleByUserLogin33 /
(33/ 0
)330 1
{44 	
StringBuilder55 
sb55 
=55 
new55 "
StringBuilder55# 0
(550 1
)551 2
;552 3
sb77 
.77 
Append77 
(77 
$str77 H
)77H I
;77I J
sb88 
.88 
Append88 
(88 
$str88 6
)886 7
;887 8
return:: 
sb:: 
.:: 
ToString:: 
(:: 
)::  
;::  !
};; 	
public== 
static== 
string== 
GetCountReturnToDay== 0
(==0 1
)==1 2
{>> 	
StringBuilder?? 
sb?? 
=?? 
new?? "
StringBuilder??# 0
(??0 1
)??1 2
;??2 3
sbAA 
.AA 
AppendAA 
(AA 
$strAA C
)AAC D
;AAD E
sbBB 
.BB 
AppendBB 
(BB 
$strBB ]
)BB] ^
;BB^ _
returnDD 
sbDD 
.DD 
ToStringDD 
(DD 
)DD  
;DD  !
}EE 	
publicGG 
staticGG 
stringGG 
GetCountRequestGG ,
(GG, -
)GG- .
{HH 	
StringBuilderII 
sbII 
=II 
newII "
StringBuilderII# 0
(II0 1
)II1 2
;II2 3
sbKK 
.KK 
AppendKK 
(KK 
$strKK :
)KK: ;
;KK; <
returnMM 
sbMM 
.MM 
ToStringMM 
(MM 
)MM  
;MM  !
}NN 	
}OO 
}PP 