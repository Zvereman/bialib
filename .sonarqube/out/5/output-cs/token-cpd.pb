ÆQ
MC:\vsproj\beck\bia.internal.booklibrary\BooksLoader\DeleteUnDefinatedBooks.cs
	namespace

 	
BooksLoader


 
{ 
public 

static 
class "
DeleteUnDefinatedBooks .
{ 
public 
static 
void 
Do 
( 
string $
path% )
)) *
{ 	
var 
excel 
= 
new 

XLWorkbook &
(& '
path' +
)+ ,
;, -
var 
titles 
= 
new 
List !
<! "
string" (
>( )
() *
)* +
;+ ,
foreach 
( 
var 
sheet 
in !
excel" '
.' (

Worksheets( 2
)2 3
{ 
var 
rows 
= 
sheet  
.  !
RowsUsed! )
() *
)* +
;+ ,
var 

nameColumn 
=  
sheet! &
.& '
Column' -
(- .
$num. /
)/ 0
.0 1
ColumnNumber1 =
(= >
)> ?
;? @
titles 
. 
AddRange 
(  
rows  $
.$ %
Select% +
(+ ,
q, -
=>. 0
q1 2
.2 3
Cell3 7
(7 8

nameColumn8 B
)B C
.C D
	GetStringD M
(M N
)N O
)O P
.P Q
ToListQ W
(W X
)X Y
)Y Z
;Z [
} 
using 
( 
var 
ctx 
= 
new   
BookDbContextFactory! 5
(5 6
)6 7
.7 8
CreateDbContext8 G
(G H
newH K
stringL R
[R S
]S T
{U V
}W X
)X Y
)Y Z
{ 
var 
books 
= 
ctx 
.  

PaperBooks  *
.* +
Where+ 0
(0 1
q1 2
=>2 4
titles4 :
.: ;
Contains; C
(C D
qD E
.E F
TitleF K
)K L
)L M
;M N
var 
exceptBooks 
=  !
new" %
List& *
<* +
	PaperBook+ 4
>4 5
(5 6
)6 7
;7 8
foreach 
( 
var 
title "
in# %
titles& ,
), -
{   
var!! 
doubles!! 
=!!  !
books!!" '
.!!' (
Where!!( -
(!!- .
q!!. /
=>!!0 2
q!!3 4
.!!4 5
Title!!5 :
==!!; =
title!!> C
)!!C D
.!!D E
ToList!!E K
(!!K L
)!!L M
;!!M N
if"" 
("" 
doubles"" 
.""  
Count""  %
(""% &
)""& '
<=""' )
$num"") *
)""* +
{## 
if$$ 
($$ 
doubles$$ "
.$$" #
Count$$# (
($$( )
)$$) *
>$$* +
$num$$+ ,
)$$, -
exceptBooks%% #
.%%# $
Add%%$ '
(%%' (
doubles%%( /
.%%/ 0
First%%0 5
(%%5 6
)%%6 7
)%%7 8
;%%8 9
}&& 
else'' 
{(( 
var)) 
temp))  
=))! "
doubles))# *
.))* +
Where))+ 0
())0 1
q))1 2
=>))3 5
q))6 7
.))7 8
RentHistory))8 C
.))C D
Any))D G
())G H
)))H I
)))I J
;))J K
if** 
(** 
temp**  
.**  !
Any**! $
(**$ %
)**% &
)**& '
{++ 
exceptBooks,, '
.,,' (
AddRange,,( 0
(,,0 1
temp,,1 5
),,5 6
;,,6 7
}-- 
else.. 
{// 
temp00  
=00! "
doubles00# *
.00* +
Where00+ 0
(000 1
q001 2
=>003 5
q006 7
.007 8
ReqestBooks008 C
.00C D
Any00D G
(00G H
)00H I
)00I J
;00J K
if11 
(11  
temp11  $
.11$ %
Any11% (
(11( )
)11) *
)11* +
{22 
exceptBooks33  +
.33+ ,
AddRange33, 4
(334 5
temp335 9
)339 :
;33: ;
}44 
else55  
{66 
exceptBooks77  +
.77+ ,
Add77, /
(77/ 0
doubles770 7
.777 8
First778 =
(77= >
)77> ?
)77? @
;77@ A
}88 
}99 
};; 
}<< 
var== 
deleted_books== !
===" #
books==$ )
.==) *
Except==* 0
(==0 1
exceptBooks==1 <
)==< =
;=== >
var>> 
deleted_authors>> #
=>>$ %
new>>& )
List>>* .
<>>. /

BookAuthor>>/ 9
>>>9 :
(>>: ;
)>>; <
;>>< =
var?? 
deleted_categories?? &
=??' (
new??) ,
List??- 1
<??1 2
BookCategory??2 >
>??> ?
(??? @
)??@ A
;??A B
var@@ 
deleted_revievs@@ #
=@@$ %
new@@& )
List@@* .
<@@. /
Review@@/ 5
>@@5 6
(@@6 7
)@@7 8
;@@8 9
varAA 
deleted_requestsAA $
=AA% &
newAA' *
ListAA+ /
<AA/ 0
RequestBookAA0 ;
>AA; <
(AA< =
)AA= >
;AA> ?
foreachBB 
(BB 
varBB 
delBB  
inBB! #
deleted_booksBB$ 1
)BB1 2
{CC 
varDD 
tepaDD 
=DD 
ctxDD "
.DD" #
BookAuthorsDD# .
.DD. /
WhereDD/ 4
(DD4 5
qDD5 6
=>DD6 8
qDD8 9
.DD9 :
BookDD: >
.DD> ?
BiaIdDD? D
==DDD F
delDDF I
.DDI J
BiaIdDDJ O
)DDO P
;DDP Q
varEE 
tepcEE 
=EE 
ctxEE "
.EE" #
BookCategoriesEE# 1
.EE1 2
WhereEE2 7
(EE7 8
qEE8 9
=>EE9 ;
qEE; <
.EE< =
BookEE= A
.EEA B
BiaIdEEB G
==EEG I
delEEI L
.EEL M
BiaIdEEM R
)EER S
;EES T
varFF 
teprFF 
=FF 
ctxFF "
.FF" #
ReviewsFF# *
.FF* +
WhereFF+ 0
(FF0 1
qFF1 2
=>FF3 5
qFF6 7
.FF7 8
BookIdFF8 >
==FF? A
delFFB E
.FFE F
BiaIdFFF K
)FFK L
;FFL M
varGG 
teprqGG 
=GG 
ctxGG  #
.GG# $
RequestBooksGG$ 0
.GG0 1
WhereGG1 6
(GG6 7
qGG7 8
=>GG9 ;
qGG< =
.GG= >
BookIdGG> D
==GGE G
delGGH K
.GGK L
BiaIdGGL Q
)GGQ R
;GGR S
ifHH 
(HH 
tepaHH 
.HH 
AnyHH  
(HH  !
)HH! "
)HH" #
deleted_authorsHH$ 3
.HH3 4
AddRangeHH4 <
(HH< =
tepaHH= A
)HHA B
;HHB C
ifII 
(II 
tepcII 
.II 
AnyII  
(II  !
)II! "
)II" #
deleted_categoriesII$ 6
.II6 7
AddRangeII7 ?
(II? @
tepcII@ D
)IID E
;IIE F
ifJJ 
(JJ 
teprJJ 
.JJ 
AnyJJ  
(JJ  !
)JJ! "
)JJ" #
deleted_revievsJJ$ 3
.JJ3 4
AddRangeJJ4 <
(JJ< =
teprJJ= A
)JJA B
;JJB C
ifKK 
(KK 
teprqKK 
.KK 
AnyKK !
(KK! "
)KK" #
)KK# $
deleted_requestsKK% 5
.KK5 6
AddRangeKK6 >
(KK> ?
teprqKK? D
)KKD E
;KKE F
}LL 
ifMM 
(MM 
deleted_authorsMM "
.MM" #
AnyMM# &
(MM& '
)MM' (
)MM( )
ctxMM* -
.MM- .
BookAuthorsMM. 9
.MM9 :
RemoveRangeMM: E
(MME F
deleted_authorsMMF U
)MMU V
;MMV W
ifNN 
(NN 
deleted_categoriesNN &
.NN& '
AnyNN' *
(NN* +
)NN+ ,
)NN, -
ctxNN. 1
.NN1 2
BookCategoriesNN2 @
.NN@ A
RemoveRangeNNA L
(NNL M
deleted_categoriesNNM _
)NN_ `
;NN` a
ifOO 
(OO 
deleted_revievsOO #
.OO# $
AnyOO$ '
(OO' (
)OO( )
)OO) *
ctxOO+ .
.OO. /
ReviewsOO/ 6
.OO6 7
RemoveRangeOO7 B
(OOB C
deleted_revievsOOC R
)OOR S
;OOS T
ifPP 
(PP 
deleted_requestsPP $
.PP$ %
AnyPP% (
(PP( )
)PP) *
)PP* +
ctxPP, /
.PP/ 0
RequestBooksPP0 <
.PP< =
RemoveRangePP= H
(PPH I
deleted_requestsPPI Y
)PPY Z
;PPZ [
ifQQ 
(QQ 
deleted_booksQQ !
.QQ! "
AnyQQ" %
(QQ% &
)QQ& '
)QQ' (
ctxQQ) ,
.QQ, -
BooksQQ- 2
.QQ2 3
RemoveRangeQQ3 >
(QQ> ?
deleted_booksQQ? L
)QQL M
;QQM N
ctxRR 
.RR 
SaveChangesRR 
(RR  
)RR  !
;RR! "
}SS 
}UU 	
}VV 
}WW —=
AC:\vsproj\beck\bia.internal.booklibrary\BooksLoader\ParseExcel.cs
	namespace 	
BooksLoader
 
{ 
public 

static 
class 

ParseExcel "
{ 
public 
static 
void 
Do 
( 
string $
path% )
)) *
{ 	
using 
( 
var 
ctx 
= 
new   
BookDbContextFactory! 5
(5 6
)6 7
.7 8
CreateDbContext8 G
(G H
newH K
stringL R
[R S
]S T
{U V
}W X
)X Y
)Y Z
{ 
var 
excel 
= 
new 

XLWorkbook  *
(* +
path+ /
)/ 0
;0 1
foreach 
( 
var 
sheet "
in# %
excel& +
.+ ,

Worksheets, 6
)6 7
{ 
var 
rows 
= 
sheet $
.$ %
RowsUsed% -
(- .
). /
;/ 0
var 

nameColumn "
=# $
sheet% *
.* +
Column+ 1
(1 2
$num2 3
)3 4
.4 5
ColumnNumber5 A
(A B
)B C
;C D
var 
authorColumn $
=% &
sheet' ,
., -
Column- 3
(3 4
$num4 5
)5 6
.6 7
ColumnNumber7 C
(C D
)D E
;E F
foreach   
(   
var    
row  ! $
in  % '
rows  ( ,
)  , -
{!! 
var## 
currentAuthors## *
=##+ ,
new##- 0
List##1 5
<##5 6
Author##6 <
>##< =
(##= >
)##> ?
;##? @
var$$ 
	authorRaw$$ %
=$$& '
row$$( +
.$$+ ,
Cell$$, 0
($$0 1
authorColumn$$1 =
)$$= >
.$$> ?
	GetString$$? H
($$H I
)$$I J
;$$J K
if%% 
(%% 
!%% 
string%% #
.%%# $
IsNullOrWhiteSpace%%$ 6
(%%6 7
	authorRaw%%7 @
)%%@ A
)%%A B
foreach&& #
(&&$ %
var&&% (
author&&) /
in&&0 2
	authorRaw&&3 <
.&&< =
Split&&= B
(&&B C
$char&&C F
)&&F G
.&&G H
Where&&H M
(&&M N
q&&N O
=>&&P R
!&&S T
q&&T U
.&&U V
Contains&&V ^
(&&^ _
$str&&_ h
)&&h i
)&&i j
)&&j k
{'' 
var((  #
first(($ )
=((* +
$str((, .
;((. /
var))  #
second))$ *
=))+ ,
$str))- /
;))/ 0
var**  #
midle**$ )
=*** +
$str**, .
;**. /
var++  #
splits++$ *
=+++ ,
author++- 3
.++3 4
Split++4 9
(++9 :
new++: =
char++> B
[++B C
]++C D
{++E F
$char++G J
,++J K
$char++L O
}++P Q
)++Q R
;++R S
if--  "
(--# $
splits--$ *
.--* +
Length--+ 1
==--2 4
$num--5 6
)--6 7
{..  !
second//$ *
=//+ ,
splits//- 3
[//3 4
$num//4 5
]//5 6
;//6 7
}00  !
else11  $
{22  !
if33$ &
(33' (
splits33( .
.33. /
Length33/ 5
==336 8
$num339 :
)33: ;
{44$ %
first55( -
=55. /
splits550 6
[556 7
$num557 8
]558 9
;559 :
second66( .
=66/ 0
splits661 7
[667 8
$num668 9
]669 :
;66: ;
}77$ %
else88$ (
if88) +
(88, -
splits88- 3
.883 4
Length884 :
==88; =
$num88> ?
)88? @
{99$ %
first::( -
=::. /
splits::0 6
[::6 7
$num::7 8
]::8 9
;::9 :
second;;( .
=;;/ 0
splits;;1 7
[;;7 8
$num;;8 9
];;9 :
;;;: ;
midle<<( -
=<<. /
splits<<0 6
[<<6 7
$num<<7 8
]<<8 9
;<<9 :
}==$ %
else>>$ (
{??$ %
second@@( .
=@@/ 0
author@@1 7
;@@7 8
}AA$ %
}BB  !
varDD  #
resDD$ '
=DD( )
newDD* -
AuthorDD. 4
(DD4 5
)DD5 6
;DD6 7
ifEE  "
(EE# $
!EE$ %
stringEE% +
.EE+ ,
IsNullOrEmptyEE, 9
(EE9 :
firstEE: ?
)EE? @
)EE@ A
resEEB E
.EEE F
	FirstNameEEF O
=EEP Q
firstEER W
;EEW X
ifFF  "
(FF# $
!FF$ %
stringFF% +
.FF+ ,
IsNullOrEmptyFF, 9
(FF9 :
midleFF: ?
)FF? @
)FF@ A
resFFB E
.FFE F

MiddleNameFFF P
=FFQ R
midleFFS X
;FFX Y
ifGG  "
(GG# $
!GG$ %
stringGG% +
.GG+ ,
IsNullOrEmptyGG, 9
(GG9 :
secondGG: @
)GG@ A
)GGA B
resGGC F
.GGF G
LastNameGGG O
=GGP Q
secondGGR X
;GGX Y
currentAuthorsHH  .
.HH. /
AddHH/ 2
(HH2 3
resHH3 6
)HH6 7
;HH7 8
}II 
varLL 
bookLL  
=LL! "
newLL# &
	PaperBookLL' 0
(LL0 1
)LL1 2
;LL2 3
bookMM 
.MM 
TitleMM "
=MM# $
rowMM% (
.MM( )
CellMM) -
(MM- .

nameColumnMM. 8
)MM8 9
.MM9 :
	GetStringMM: C
(MMC D
)MMD E
;MME F
ctxTT 
.TT 
AuthorsTT #
.TT# $
AddRangeTT$ ,
(TT, -
currentAuthorsTT- ;
)TT; <
;TT< =
ctxUU 
.UU 
BooksUU !
.UU! "
AddUU" %
(UU% &
bookUU& *
)UU* +
;UU+ ,
ctxVV 
.VV 
SaveChangesVV '
(VV' (
)VV( )
;VV) *
varXX 
relationXX $
=XX% &
newXX' *
ListXX+ /
<XX/ 0

BookAuthorXX0 :
>XX: ;
(XX; <
)XX< =
;XX= >
foreachYY 
(YY  !
varYY! $
currYY% )
inYY* ,
currentAuthorsYY- ;
)YY; <
{ZZ 
relation[[ $
.[[$ %
Add[[% (
([[( )
new[[) ,

BookAuthor[[- 7
([[7 8
)[[8 9
{\\ 
	AuthorUid]]  )
=]]* +
curr]], 0
.]]0 1
	AuthorUid]]1 :
,]]: ;
BookId^^  &
=^^' (
book^^) -
.^^- .
BiaId^^. 3
}__ 
)__ 
;__ 
}`` 
ctxbb 
.bb 
BookAuthorsbb '
.bb' (
AddRangebb( 0
(bb0 1
relationbb1 9
)bb9 :
;bb: ;
ctxcc 
.cc 
SaveChangescc '
(cc' (
)cc( )
;cc) *
}dd 
}ee 
}ff 
}gg 	
}hh 
}ii Â
>C:\vsproj\beck\bia.internal.booklibrary\BooksLoader\Program.cs
	namespace

 	
BooksLoader


 
{ 
class 	
Program
 
{ 
static 
void 
Main 
( 
string 
[  
]  !
args" &
)& '
{ 	
var 
builder 
= 
new  
ConfigurationBuilder 2
(2 3
)3 4
. 
SetBasePath 
( 
	Directory &
.& '
GetCurrentDirectory' :
(: ;
); <
)< =
. 
AddJsonFile 
( 
$str /
,/ 0
optional1 9
:9 :
true; ?
,? @
reloadOnChangeA O
:O P
trueQ U
)U V
;V W
Console 
. 
	WriteLine 
( 
$str B
)B C
;C D
var 
path 
= 
Console 
. 
ReadLine '
(' (
)( )
;) *
if 
( 
File 
. 
Exists 
( 
path  
)  !
)! "
{ 
try 
{ "
DeleteUnDefinatedBooks *
.* +
Do+ -
(- .
path. 2
)2 3
;3 4
} 
catch 
( 
	Exception  
e! "
)" #
{ 
Console 
. 
	WriteLine %
(% &
e& '
.' (
Message( /
)/ 0
;0 1
Console 
. 
Read  
(  !
)! "
;" #
}   
}!! 
else"" 
{## 
Console$$ 
.$$ 
	WriteLine$$ !
($$! "
$str$$" ;
)$$; <
;$$< =
}%% 
}&& 	
}'' 
}(( 